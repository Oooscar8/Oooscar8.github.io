

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/imgs/wallhaven-p9qeze.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Alex Sun">
  <meta name="keywords" content="">
  
    <meta name="description" content="Set up the environment for OS&#x2F;161 and get familiar with the source code">
<meta property="og:type" content="article">
<meta property="og:title" content="OS161 Assignment 1">
<meta property="og:url" content="http://oooscar8.github.io/2024/09/16/OS161-A1/index.html">
<meta property="og:site_name" content="Alex&#39;s Space">
<meta property="og:description" content="Set up the environment for OS&#x2F;161 and get familiar with the source code">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oooscar8.github.io/2024/09/16/imgs/202410111833937.png">
<meta property="article:published_time" content="2024-09-15T16:00:00.000Z">
<meta property="article:modified_time" content="2025-02-23T09:26:37.647Z">
<meta property="article:author" content="Alex Sun">
<meta property="article:tag" content="OS">
<meta property="article:tag" content="OS161">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://oooscar8.github.io/2024/09/16/imgs/202410111833937.png">
  
  
  
  <title>OS161 Assignment 1 - Alex&#39;s Space</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"oooscar8.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Alex&#39;s Space</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/imgs/chuyin.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="OS161 Assignment 1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-16 00:00" pubdate>
          2024年9月16日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          9 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">OS161 Assignment 1</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="assignment1"><a class="markdownIt-Anchor" href="#assignment1"></a> Assignment1</h1>
<p>The purpose of this assignment is to get you started with OS/161.</p>
<p>By the time you complete this assignment, you will have mastered the following:</p>
<ul>
<li>Install the environment for running OS/161</li>
<li>Set up and use a git source control repository for your source code.</li>
<li>Fetch and build the kernel source tree.</li>
<li>Become familiar with the OS/161 source tree.</li>
<li>Learn the basics of using the debugger.</li>
</ul>
<h2 id="step-1-os161-installation"><a class="markdownIt-Anchor" href="#step-1-os161-installation"></a> Step 1. OS/161 installation</h2>
<h3 id="1-set-up-the-environment"><a class="markdownIt-Anchor" href="#1-set-up-the-environment"></a> 1. Set up the environment</h3>
<p>Use the tools in a Docker container.</p>
<h4 id="prep-the-work-directory-for-docker"><a class="markdownIt-Anchor" href="#prep-the-work-directory-for-docker"></a> Prep the work directory for Docker</h4>
<ul>
<li>clone the repository</li>
</ul>
<p>Clone the repository with SSH.</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">... src</span><br></code></pre></td></tr></table></figure>
<div class="note note-danger">
            <p>Clone the repository in <code>wsl</code>. Clone the repo in windows bash causes <code>invalid path error</code>.</p>
          </div>
<blockquote>
<p>Reference: <a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~os161/os161-site/git-intro.html">An introductory guide to git</a></p>
</blockquote>
<ul>
<li>Additional Configuration</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.name</span> <span class="hljs-string">&quot;Your Name&quot;</span><br>git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.email</span> <span class="hljs-string">&quot;yourname@server.ca&quot;</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Merging Conflicts</li>
</ul>
<blockquote>
<p>Reference: <a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~os161/os161-site/git-merge.html">Tutorial</a></p>
</blockquote>
<h4 id="build-the-container"><a class="markdownIt-Anchor" href="#build-the-container"></a> Build the container</h4>
<p>Download and run the script to set up the Docker container with the required environment for running os161.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">wget https:<span class="hljs-comment">//people.ece.ubc.ca/~os161/download/os161-cpen331-docker.tar.gz</span><br>gunzip os161-cpen331-docker<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span><br>tar -xvf os161-cpen331-docker<span class="hljs-selector-class">.tar</span><br>cd os161-cpen331-docker<br>docker build -t os161 .<br></code></pre></td></tr></table></figure>
<h4 id="run-the-container"><a class="markdownIt-Anchor" href="#run-the-container"></a> Run the container</h4>
<p>The following command will run the Docker container and will mount your home directory so that it is accessible from within the container. In the following command replace /home/OS_BASE with the name of the current directory.</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> -dit --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,src=/home/OS_BASE,target=/root/os161 --<span class="hljs-built_in">rm</span> --name os161 os161</span><br></code></pre></td></tr></table></figure>
<p>The previous command printed the container ID, which you will use for the next command. You may also obtain the container ID anytime by running:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps</span><br></code></pre></td></tr></table></figure>
<p>Next you will get a shell to enter your container, using the container ID.</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">docker <span class="hljs-keyword">exec</span> -it [<span class="hljs-keyword">container</span> ID]/[<span class="hljs-keyword">container</span> name] /bin/bash<br></code></pre></td></tr></table></figure>
<p>Now you are inside the container! In other words, you are running inside the guest. Execute the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/os161<br></code></pre></td></tr></table></figure>
<p>The os161 directory you just entered maps to <code>home/OS161_BASE</code> on the host. In that directory you will see the clone of your repo that you brought into <code>src</code> directory.</p>
<h3 id="2-build-os-161-configure-and-build-the-source-tree"><a class="markdownIt-Anchor" href="#2-build-os-161-configure-and-build-the-source-tree"></a> 2. Build OS 161 — configure and build the source tree</h3>
<blockquote>
<p>Reference: <a target="_blank" rel="noopener" href="http://www.os161.org/resources/building.html">The OS161 building instructions</a></p>
</blockquote>
<h4 id="configure-the-tree"><a class="markdownIt-Anchor" href="#configure-the-tree"></a> Configure the tree</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/os161/src<br>./configure --ostree=<span class="hljs-variable">$HOME</span>/os161/root<br></code></pre></td></tr></table></figure>
<div class="note note-danger">
            <p>Use <code>.gitignore</code> to tell the version control system to ignore the file <code>defs.mk</code>.</p>
          </div>
<h4 id="build-userland"><a class="markdownIt-Anchor" href="#build-userland"></a> Build userland</h4>
<p>Type <code>bmake</code> in the top level of the source tree:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">bmake</span><br></code></pre></td></tr></table></figure>
<p>Type <code>bmake install</code> to copy the results into ~/os161/root:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bmake <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure>
<h4 id="configure-a-kernel"><a class="markdownIt-Anchor" href="#configure-a-kernel"></a> Configure a kernel</h4>
<p>Run the OS/161 config program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> kern/conf<br>./config DUMBVM<br></code></pre></td></tr></table></figure>
<h4 id="compile-a-kernel"><a class="markdownIt-Anchor" href="#compile-a-kernel"></a> Compile a kernel</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/os161/src/kern/compile/DUMBVM<br></code></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">bmake depend</span><br></code></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">bmake</span><br></code></pre></td></tr></table></figure>
<p>Copy the kernel to ~/os161/root:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bmake <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure>
<h4 id="run-the-kernel"><a class="markdownIt-Anchor" href="#run-the-kernel"></a> Run the kernel</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/os161/root<br></code></pre></td></tr></table></figure>
<p>You will run os161 on top sys161 -- a MIPS hardware simulator. So first you need to get a configuration file for sys161.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget people.ece.ubc.ca/os161/download/sys161.conf.sample -O ~/os161/root/sys161.conf<br></code></pre></td></tr></table></figure>
<p>Now run your kernel:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sys161</span> kernel<br></code></pre></td></tr></table></figure>
<h2 id="step-2-tag-your-repository"><a class="markdownIt-Anchor" href="#step-2-tag-your-repository"></a> Step 2. Tag your repository</h2>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">asst1-start</span><br>git push --tags<br></code></pre></td></tr></table></figure>
<h2 id="step-3-create-your-submit-file"><a class="markdownIt-Anchor" href="#step-3-create-your-submit-file"></a> Step 3. Create your submit file</h2>
<p>create submit file in <code>src</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> submit<br><span class="hljs-built_in">cd</span> submit<br><span class="hljs-built_in">mkdir</span> asst1<br><span class="hljs-built_in">cd</span> asst1<br><span class="hljs-built_in">touch</span> asst1-answers.md<br></code></pre></td></tr></table></figure>
<h2 id="step-4-copy-some-output-from-git-commands-into-your-submit-file"><a class="markdownIt-Anchor" href="#step-4-copy-some-output-from-git-commands-into-your-submit-file"></a> Step 4. Copy some output from git commands into your submit file</h2>
<ol>
<li>invoke sys161 with the newly built kernel</li>
</ol>
<p>input:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/os161/root<br>sys161 kernel<br></code></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sys161</span>: System/<span class="hljs-number">161</span> release <span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>, compiled Sep  <span class="hljs-number">5</span> <span class="hljs-number">2024</span> <span class="hljs-number">20</span>:<span class="hljs-number">22</span>:<span class="hljs-number">57</span><br><br><span class="hljs-attribute">OS</span>/<span class="hljs-number">161</span> base system version <span class="hljs-number">1</span>.<span class="hljs-number">99</span>.<span class="hljs-number">08</span><br><span class="hljs-attribute">Copyright</span> (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2001</span>-<span class="hljs-number">2005</span>, <span class="hljs-number">2008</span>-<span class="hljs-number">2011</span>, <span class="hljs-number">2013</span>, <span class="hljs-number">2014</span><br>   <span class="hljs-attribute">President</span> and Fellows of Harvard College.  <span class="hljs-literal">All</span> rights reserved.<br><br><span class="hljs-attribute">Put</span>-your-group-name-here&#x27;s system version <span class="hljs-number">0</span> (DUMBVM #<span class="hljs-number">2</span>)<br><br><span class="hljs-attribute">292k</span> physical memory available<br><span class="hljs-attribute">Device</span> probe...<br><span class="hljs-attribute">lamebus0</span> (system main bus)<br><span class="hljs-attribute">emu0</span> at lamebus0<br><span class="hljs-attribute">ltrace0</span> at lamebus0<br><span class="hljs-attribute">ltimer0</span> at lamebus0<br><span class="hljs-attribute">beep0</span> at ltimer0<br><span class="hljs-attribute">rtclock0</span> at ltimer0<br><span class="hljs-attribute">lrandom0</span> at lamebus0<br><span class="hljs-attribute">random0</span> at lrandom0<br><span class="hljs-attribute">lhd0</span> at lamebus0<br><span class="hljs-attribute">lhd1</span> at lamebus0<br><span class="hljs-attribute">lser0</span> at lamebus0<br><span class="hljs-attribute">con0</span> at lser0<br><br><span class="hljs-attribute">cpu0</span>: MIPS/<span class="hljs-number">161</span> (System/<span class="hljs-number">161</span> <span class="hljs-number">2</span>.x) features <span class="hljs-number">0</span>x0<br><span class="hljs-attribute">OS</span>/<span class="hljs-number">161</span> kernel<span class="hljs-meta"> [? for menu]: ?</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">OS/161 kernel menu</span><br><span class="hljs-meta">    [?o] Operations menu                [khgen] Next kernel heap generation</span><br><span class="hljs-meta">    [?t] Tests menu                     [khdump] Dump kernel heap</span><br><span class="hljs-meta">    [kh] Kernel heap stats              [q] Quit and shut down</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">Operation took 0.481954360 seconds</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>make sure that the git repository is working</li>
</ol>
<p>input:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">git <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">commit</span> b2e7d28ff0d4113ea3b9e53e7aca73069feeb5d2 (HEAD -&gt; master)<br><span class="hljs-attribute">Author</span>: root &lt;root@localhost&gt;<br><span class="hljs-attribute">Date</span>:   Fri Sep <span class="hljs-number">6</span> <span class="hljs-number">20</span>:<span class="hljs-number">24</span>:<span class="hljs-number">16</span> <span class="hljs-number">2024</span> +<span class="hljs-number">0000</span><br><br>    <span class="hljs-attribute">Updated</span> .gitignore<br><br><span class="hljs-attribute">commit</span> <span class="hljs-number">5</span>c4e39fa04a747a210a11fd9940768dda61981c0 (tag: asst1-start, origin/master, origin/HEAD)<br><span class="hljs-attribute">Author</span>: root &lt;root@localhost&gt;<br><span class="hljs-attribute">Date</span>:   Thu Sep <span class="hljs-number">5</span> <span class="hljs-number">22</span>:<span class="hljs-number">25</span>:<span class="hljs-number">13</span> <span class="hljs-number">2024</span> +<span class="hljs-number">0000</span><br><br>    <span class="hljs-attribute">Ignore</span> defs.mk file<br><br><span class="hljs-attribute">commit</span> <span class="hljs-number">341</span>e69822e0908f5c521e68e7c71f68e4c10119d<br><span class="hljs-attribute">Author</span>: Alex Sun &lt;oscar8@sjtu.edu.cn&gt;<br><span class="hljs-attribute">Date</span>:   Thu Sep <span class="hljs-number">5</span> <span class="hljs-number">15</span>:<span class="hljs-number">08</span>:<span class="hljs-number">36</span> <span class="hljs-number">2024</span> -<span class="hljs-number">0700</span><br><br>    <span class="hljs-attribute">Initial</span> commit<br></code></pre></td></tr></table></figure>
<p>input:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span><br></code></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">asst1-<span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure>
<h2 id="step-5-complete-the-code-reading-exercises"><a class="markdownIt-Anchor" href="#step-5-complete-the-code-reading-exercises"></a> Step 5. Complete the code reading exercises</h2>
<blockquote>
<p>Reference: <a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~os161/os161-site/browse-code.html">Browse the source code</a></p>
</blockquote>
<blockquote>
<p><strong>Question 1:</strong> In the book chapters and in class you were introduced to the mechanisms used to transfer control between user processes and the operating system. Tell us where we can find the first line of OS/161 code that is executed when a trap occurs. Then tell us where control gets transferred to from that point. What about an interrupt? How does that differ?</p>
</blockquote>
<p>Look at the code in file <code>os161/src/kern/arch/mips/locore/exception-mips1.S</code></p>
<p>When a trap occurs,</p>
<p>If it is an UTLB exception, the first line of <code>mips_utlb_handler</code> would be the first line of OS/161 code that is executed when the trap occurs.</p>
<p>If it is a general exception, the first line of <code>mips_general_handler</code> would be the first line of OS/161 code that is executed when the trap occurs.</p>
<p>After the <code>trapframe</code> is set up, it transfers control to <code>mips_trap</code></p>
<p><code>mips_trap</code> determines whether it is a system call or an interrupt or something else.</p>
<p>If it is an interrupt, it then transfers control to interrupt handler.</p>
<blockquote>
<p><strong>Question 2:</strong> Making a system call, such as write, ultimately leads to a trap. Find the code in OS/161 that invokes system calls <strong>from user programs</strong> and causes traps. In which file and on which lines did you find this code?</p>
</blockquote>
<p>The <code>syscall</code> instruction on line 84 of <code>userland/lib/libc/arch/mips/syscalls-mips.S</code> is responsible for invoking the trap.</p>
<img src="/imgs/202410111833937.png" srcset="/img/loading.gif" lazyload alt="" style="zoom: 67%;" />
<blockquote>
<p><strong>Question 3:</strong> Why do you suppose there are <code>libc</code> functions in the &quot;common&quot; part of the source tree (<code>common/libc</code>) as well as in <code>userland/lib/libc</code>?</p>
</blockquote>
<p>The <code>common/libc</code> library provides implementations of C standard library functions to both the kernel and user programs, focusing mainly on core functionalities needed by the kernel, avoiding complexity of user-space features.</p>
<p>The <code>userland/lib/libc</code> library provides implementations of C standard library functions to the user space, dealing with more complex scenarios involving system calls…</p>
<blockquote>
<p>Below is a brief overview of the organization of the source tree, and a description of what goes where.</p>
</blockquote>
<blockquote>
<ul>
<li>configure -- top-level configuration script; configures the OS/161 distribution and build system. It does not configure the operating system kernel, which is a slightly different kind of configuration.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 4:</strong> Name two things that configure configures. What might invalidate that configuration and make you need/want to rerun it?</p>
</blockquote>
<ol>
<li>
<p>The configure file designates the target hardware platform and machine type.</p>
</li>
<li>
<p>The configure file designates the default location of the root of the installed system.</p>
</li>
</ol>
<p>If I move my source tree to a different computer that is running a different OS, the configuration will be invalid and I need to rerun the configure file.</p>
<blockquote>
<ul>
<li><code>Makefile</code> -- top-level <code>makefile</code>; builds the OS/161 distribution, including all the provided utilities, but does not build the operating system kernel.</li>
<li><code>common/</code> -- code used both by the kernel and user-level programs, mostly standard C library functions.</li>
<li><code>kern/</code> -- the kernel source code.</li>
<li><code>kern/Makefile</code> -- Once again, there is a <code>Makefile</code>. This <code>Makefile</code> installs header files but does not build anything.</li>
<li><code>kern/arch/</code> -- This is where architecture-specific code goes. By architecture-specific, we mean the code that differs depending on the hardware platform on which you're running. There are two directories here: mips which contains code specific to the MIPS processor and sys161 which contains code specific to the System/161 simulator.</li>
<li><code>kern/arch/mips/conf/conf.arch</code> -- This tells the kernel config script where to find the machine-specific, low-level functions it needs (throughout <code>kern/arch/mips/*</code>).</li>
<li><code>kern/arch/mips/include/</code> -- This folder and its subdirectories include files for the machine-specific constants and functions.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 5:</strong> What are some of the details which would make a function &quot;machine dependent&quot;? Why might it be important to maintain this separation, instead of just putting all of the code in one function?</p>
</blockquote>
<ul>
<li>Machine Dependent Details:</li>
</ul>
<ol>
<li>
<p>Functions that utilize specific processor instructions (assembly code) or rely on features unique to a particular CPU architecture</p>
</li>
<li>
<p>Functions accessing memory regions that are hard-wired to specific physical memory</p>
</li>
<li>
<p>Functions dealing with interrupts(traps) or low-level I/O operation</p>
</li>
</ol>
<ul>
<li>It is important to separate machine-dependent functions from machine-independent functions for the following reasons:</li>
</ul>
<ol>
<li>Machine-independent functions can be reused across different architecture. It would be easier to port the software to different hardware architectures.</li>
<li>Keep the codebase organized and easy to understand, as well as easy to maintain and modify, without affecting other functions.</li>
</ol>
<blockquote>
<ul>
<li>kern/arch/mips/* -- The other directories contain source files for the machine-dependent code that the kernel needs to run. A lot of this code is in assembler and will seem very low level, but understanding how it all fits together will help you immensely on Assignment 2.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 6:</strong> How large is a <code>trapframe</code>? Why?</p>
</blockquote>
<p>Look at the code in file <code>os161/src/kern/arch/mips/include/trapframe.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> &#123;</span><br>	<span class="hljs-type">uint32_t</span> tf_vaddr;	<span class="hljs-comment">/* coprocessor 0 vaddr register */</span><br>	<span class="hljs-type">uint32_t</span> tf_status;	<span class="hljs-comment">/* coprocessor 0 status register */</span><br>	<span class="hljs-type">uint32_t</span> tf_cause;	<span class="hljs-comment">/* coprocessor 0 cause register */</span><br>	<span class="hljs-type">uint32_t</span> tf_lo;<br>	<span class="hljs-type">uint32_t</span> tf_hi;<br>	<span class="hljs-type">uint32_t</span> tf_ra;		<span class="hljs-comment">/* Saved register 31 */</span><br>	<span class="hljs-type">uint32_t</span> tf_at;		<span class="hljs-comment">/* Saved register 1 (AT) */</span><br>	<span class="hljs-type">uint32_t</span> tf_v0;		<span class="hljs-comment">/* Saved register 2 (v0) */</span><br>	<span class="hljs-type">uint32_t</span> tf_v1;		<span class="hljs-comment">/* etc. */</span><br>	<span class="hljs-type">uint32_t</span> tf_a0;<br>	<span class="hljs-type">uint32_t</span> tf_a1;<br>	<span class="hljs-type">uint32_t</span> tf_a2;<br>	<span class="hljs-type">uint32_t</span> tf_a3;<br>	<span class="hljs-type">uint32_t</span> tf_t0;<br>	<span class="hljs-type">uint32_t</span> tf_t1;<br>	<span class="hljs-type">uint32_t</span> tf_t2;<br>	<span class="hljs-type">uint32_t</span> tf_t3;<br>	<span class="hljs-type">uint32_t</span> tf_t4;<br>	<span class="hljs-type">uint32_t</span> tf_t5;<br>	<span class="hljs-type">uint32_t</span> tf_t6;<br>	<span class="hljs-type">uint32_t</span> tf_t7;<br>	<span class="hljs-type">uint32_t</span> tf_s0;<br>	<span class="hljs-type">uint32_t</span> tf_s1;<br>	<span class="hljs-type">uint32_t</span> tf_s2;<br>	<span class="hljs-type">uint32_t</span> tf_s3;<br>	<span class="hljs-type">uint32_t</span> tf_s4;<br>	<span class="hljs-type">uint32_t</span> tf_s5;<br>	<span class="hljs-type">uint32_t</span> tf_s6;<br>	<span class="hljs-type">uint32_t</span> tf_s7;<br>	<span class="hljs-type">uint32_t</span> tf_t8;<br>	<span class="hljs-type">uint32_t</span> tf_t9;<br>	<span class="hljs-type">uint32_t</span> tf_k0;		<span class="hljs-comment">/* dummy (see exception-mips1.S comments) */</span><br>	<span class="hljs-type">uint32_t</span> tf_k1;		<span class="hljs-comment">/* dummy */</span><br>	<span class="hljs-type">uint32_t</span> tf_gp;<br>	<span class="hljs-type">uint32_t</span> tf_sp;<br>	<span class="hljs-type">uint32_t</span> tf_s8;<br>	<span class="hljs-type">uint32_t</span> tf_epc;	<span class="hljs-comment">/* coprocessor 0 epc register */</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<p>A <code>trapframe</code> is 37 words large because the <code>trapframe</code> structure save 37 registers during entry to the exception handler and each register data is a word long.</p>
<blockquote>
<ul>
<li><code>kern/arch/sys161/conf/conf.arch</code> -- Similar to <code>mips/conf/conf.arch</code>.</li>
<li><code>kern/arch/sys161/include</code> -- These files are include files for the System161-specific hardware, constants, and functions. machine-specific constants and functions.</li>
<li>kern/compile -- This is where you build kernels. See below.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 7:</strong> Under what circumstances should you re-run the kern/conf/config script?</p>
</blockquote>
<p>I should rerun this step if I change the kernel config, add new source files to the build, add new build options or the hardware changes.</p>
<blockquote>
<p><strong>Question 8:</strong> Under what circumstances should you run <code>bmake depend</code> in kern/compile/DUMBVM?</p>
</blockquote>
<p>I should rerun <code>bmake depend</code> if I change header file inclusions, or after re-running <code>config</code>.</p>
<blockquote>
<p><strong>Question 9:</strong> Under what circumstances should you run <code>bmake</code> or <code>bmake install</code> in kern/compile/DUMBVM?</p>
</blockquote>
<p>I should run <code>bmake</code> if I want to recompile the kernel.</p>
<p>I should also run <code>bmake install</code> when I want to copy the newly compiled kernel to <code>~/os161/root</code> where I can boot it in System/161.</p>
<blockquote>
<ul>
<li>kern/dev -- This is where all the low level device management code is stored. Unless you are really interested, you can safely ignore most of this directory.</li>
<li>kern/fs -- This is where the actual file system implementations go. The subdirectory sfs contains a simple default file system. You will augment this file system as part of Assignment 4, so we'll ask you more questions about it then. The subdirectory semfs contains a special-purpose file system that provides semaphores to user-level programs. We may ask you more questions about this later on, after we discuss in class what semaphores are.</li>
<li>kern/include -- These are the include files that the kernel needs. The kern subdirectory contains include files that are visible not only to the operating system itself, but also to user-level programs. (Think about why it's named &quot;kern&quot; and where the files end up when installed.)</li>
<li>kern/lib -- These are library routines used throughout the kernel, e.g., arrays, kernel printf, etc. Note: You can use these data structures as you implement your assignments in CS161. We strongly encourage you to look around and see what we've provided for you.</li>
<li>kern/main -- This is where the kernel is initialized and where the kernel main function is implemented.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 10:</strong> When you booted your kernel, you found that there were several commands that you could issue to experiment with it. Explain exactly where and what you would have to do to add a command that printed out, &quot;Hello world!&quot;</p>
</blockquote>
<p>Add codes that print &quot;Hello world!&quot; in code base in <code>~/src/userland/testbin</code> and re-compile the kernel.</p>
<p>Then, run <code>sys161 kernel p testbin/(hello_world_program)</code> to run the code.</p>
<blockquote>
<ul>
<li>kern/proc -- This is where process support lives. You will write most of the code that goes here during Assignments 4 and 5.</li>
<li>kern/synchprobs -- This is the directory that contains/will contain the framework code that you will need to complete assignment 1. You can safely ignore it for now.</li>
<li>kern/syscall -- This is where you will add code to create and manage user level processes. As it stands now, OS/161 runs only kernel threads; there is no support for user level code. In Assignments 4 and 5, you'll implement this support.</li>
<li>kern/thread -- Threads are the fundamental abstraction on which the kernel is built (do not forget to look back at header files!)</li>
<li>kern/vfs -- The vfs is the &quot;virtual file system.&quot; It is an abstraction for a file system and its existence in the kernel allows you to implement multiple file systems, while sharing as much code as possible. The VFS layer is the file-system independent layer. You will want to go look atvfs.h and vnode.h before looking at this directory.</li>
<li>kern/vm -- This directory is fairly vacant. In Assignments 6 and 7, you'll implement virtual memory and most of your code will go in here.</li>
<li>man/ -- the OS/161 manual (&quot;man pages&quot;) appear here. The man pages document (or specify) every program, every function in the C library, and every system call. You will use the system call man pages for reference in the course of assignment 2. The man pages are HTML and can be read with any browser.</li>
<li>mk/ -- fragments of makefiles used to build the system.</li>
<li>userland/ -- user-level libraries and program code</li>
<li>userland/bin/ -- all the utilities that are typically found in /bin, e.g., cat, cp, ls, etc. The things in bin are considered &quot;fundamental&quot; utilities that the system needs to run.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 11:</strong> Why do we need to include these in your OS/161 distribution? Why can't you just use the standard utilities that are present on the machine on which you're working?</p>
</blockquote>
<p>os161 runs in its own virtualized environment (runs on hardware simulator) with a different kernel and system call interface compared to the host machine. Standard utilities from the host operating system rely on system calls and kernel features that are not implemented in OS/161. The userland utilities in OS/161 are specifically built to interact with the OS/161 kernel and its system calls.</p>
<p>Also, OS/161 programs are compiled for the MIPS architecture, which may be different from the architecture of the host machine(x86/ARM). In that case, the standard utilities on the host machine cannot run in the OS/161 environment. OS/161 needs a set of utilities that are compiled to run specifically within the MIPS architecture.</p>
<blockquote>
<ul>
<li>userland/include/ -- these are the include files that you would typically find in <code>/usr/include</code> (in our case, a subset of them). These are user level include files; not kernel include files.</li>
<li>userland/lib/ -- library code lives here. We have only two libraries: <code>libc</code>, the C standard library, and <code>hostcompat</code>, which is for recompiling OS/161 programs for the host UNIX system. There is also a crt0 directory, which contains the startup code for user programs.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 12:</strong> When a user program exits, what is done with the program's return value?</p>
</blockquote>
<p>When a user program exits, it invokes the <code>_exit</code> system call. The kernel captures the return value and stores it in a data structure <code>struct proc</code> which contains information about the process. Later, the return value can be retrieved by the parent process using a system call (e.g. <code>waitpid()</code>). After the value is collected, the process is fully cleaned up.</p>
<blockquote>
<ul>
<li><code>userland/sbin/</code> -- this is the source code for the utilities typically found in <code>/sbin</code> on a typical UNIX installation. In our case, there are some utilities that let you halt the machine, power it off and reboot it, among other things.</li>
<li><code>userland/testbin/</code> -- this is the source code for the test programs found in <code>/testbin</code> in the installed OS/161 tree. You will want to examine this directory closely and be aware of what's available here, as many of these test programs will be useful during the course of the semester.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Question 13:</strong> Imagine that you wanted to add a new system call. List all the places that you would need to modify/add code. Then review your answers to questions 7-9 and note which of those actions you need to take in order to test the new system call.</p>
</blockquote>
<ul>
<li>Add code</li>
</ul>
<ol>
<li>Define the system call number</li>
</ol>
<p>In file<code>~/os161/src/kern/include/kern/syscall.h</code>, define the number of the newly-defined system call.</p>
<ol start="2">
<li>Declare the system call</li>
</ol>
<p>In file <code>~/os161/src/kern/include/syscall.h</code>, declare the new system call.</p>
<ol start="3">
<li>implement the system call</li>
</ol>
<p>In the path <code>~/os161/src/kern/syscall/</code>, create a source file and implement the system call.</p>
<ol start="4">
<li>Update the system call dispatcher</li>
</ol>
<p>In file <code>~/os161/src/kern/arch/mips/syscall/syscall.c</code>, add the new system call to the <code>switch</code> statement that dispatches the appropriate system call based on its number.</p>
<ol start="5">
<li>Add a prototype in the userland includes</li>
</ol>
<ul>
<li>Actions to take</li>
</ul>
<p>In order to test the new system call, I need to run:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/os161/src/kern/compile/DUMBVM<br>bmake depend<br>bmake<br>bmake install<br></code></pre></td></tr></table></figure>
<h2 id="step-6-learn-how-to-use-the-debugger"><a class="markdownIt-Anchor" href="#step-6-learn-how-to-use-the-debugger"></a> Step 6. Learn how to use the debugger</h2>
<blockquote>
<p>Reference:</p>
<p><a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~os161/os161-site/gdb-attach.html">attaching to OS161 with GDB</a></p>
<p><a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~os161/os161-site/debug-os161.html">GDB tutorial</a></p>
</blockquote>
<h2 id="step-7-trace-the-execution-from-start-to-menu"><a class="markdownIt-Anchor" href="#step-7-trace-the-execution-from-start-to-menu"></a> Step 7. Trace the execution from start to menu()</h2>
<blockquote>
<p><strong>Question 14:</strong> What is the name of the very first function that executes when OS161 starts up?</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">(gdb) <span class="hljs-built_in">db</span><br>__start () <span class="hljs-meta">at</span> ../../arch/sys161/main/start<span class="hljs-number">.</span>S:<span class="hljs-number">54</span><br><span class="hljs-number">54</span>         addiu <span class="hljs-built_in">sp</span>, <span class="hljs-built_in">sp</span>, -<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure>
<p><code>–start()</code> is the very first function that executes when OS161 starts.</p>
<blockquote>
<p><strong>Question 15:</strong> What is the very first assembly instruction that executes?</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">(gdb) <span class="hljs-built_in">db</span><br>__start () <span class="hljs-meta">at</span> ../../arch/sys161/main/start<span class="hljs-number">.</span>S:<span class="hljs-number">54</span><br><span class="hljs-number">54</span>         addiu <span class="hljs-built_in">sp</span>, <span class="hljs-built_in">sp</span>, -<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure>
<p><code>addiu sp, sp, -24</code> is the very first assembly instruction that executes.</p>
<blockquote>
<p><strong>Question 16:</strong> Set the breakpoints in the kernel function that shows the menu and in the kernel main function. Now tell GDB to display all the breakpoints that were set and copy the output to your submit file.</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">(gdb) info <span class="hljs-selector-tag">b</span><br>Num     Type           Disp Enb Address    What<br><span class="hljs-number">1</span>       breakpoint     keep y   <span class="hljs-number">0</span>x800139e4 <span class="hljs-keyword">in</span> kmain at ../../main/<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.c</span>:<span class="hljs-number">211</span><br><span class="hljs-number">2</span>       breakpoint     keep y   <span class="hljs-number">0</span>x80014a0c <span class="hljs-keyword">in</span> <span class="hljs-selector-tag">menu</span> at ../../main/<span class="hljs-selector-tag">menu</span><span class="hljs-selector-class">.c</span>:<span class="hljs-number">697</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Question 17:</strong> Briefly describe what happens between the beginning of the execution and the invocation of the kernel main function.</p>
</blockquote>
<p>First, set up the stack frame for debugging purposes, saving the return address register (<code>ra</code>) to help GDB with disassembly.</p>
<p>Then, copy the boot argument string from the stack (in register <code>a0</code>) to the kernel's <code>_end</code> address.</p>
<p>Then, determine the memory layout and initialize the kernel stack.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stata">We <span class="hljs-keyword">set</span> up the <span class="hljs-keyword">memory</span> map like this:<br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    *         top of memory</span><br><span class="hljs-comment">    *                         free memory</span><br><span class="hljs-comment">    *         P + 0x1000</span><br><span class="hljs-comment">    *                         first thread&#x27;s stack (1 page)</span><br><span class="hljs-comment">    *         P</span><br><span class="hljs-comment">    *                         wasted space (&lt; 1 page)</span><br><span class="hljs-comment">    *                         copy of the boot string</span><br><span class="hljs-comment">    *         _end</span><br><span class="hljs-comment">    *                         kernel</span><br><span class="hljs-comment">    *         0x80000200</span><br><span class="hljs-comment">    *                         exception handlers</span><br><span class="hljs-comment">    *         0x80000000</span><br></code></pre></td></tr></table></figure>
<p>Then, copy the exception handler code onto the first page of memory.</p>
<p>Then, flush the instruction cache to ensure recent changes (such as exception handler code) are correctly read by the instruction cache.</p>
<p>Then, initilize the TLB, set up the status register and the context register, and load the GP register.</p>
<p>Finally, call the kernel main function.</p>
<blockquote>
<p><strong>Question 18:</strong> What is the assembly language instruction that calls the kernel main function?</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jal kmain<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Question 19:</strong> Step through the <code>boot()</code> code to find out what functions are called during early initialization. Paste the gdb output that shows you what these functions are.</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scss">(gdb) n<br><span class="hljs-number">109</span>             <span class="hljs-built_in">ram_bootstrap</span>();<br>(gdb) n<br><span class="hljs-number">110</span>             <span class="hljs-built_in">proc_bootstrap</span>();<br>(gdb) n<br><span class="hljs-number">111</span>             <span class="hljs-built_in">thread_bootstrap</span>();<br>(gdb) n<br><span class="hljs-number">112</span>             <span class="hljs-built_in">hardclock_bootstrap</span>();<br>(gdb) n<br><span class="hljs-number">113</span>             <span class="hljs-built_in">vfs_bootstrap</span>();<br>(gdb) n<br><span class="hljs-number">114</span>             <span class="hljs-built_in">kheap_nextgeneration</span>();<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Question 20:</strong> Set a breakpoint in thread_bootstrap(). Once you hit that breakpoint, at the very first line of that function, attempt to print the contents of the *bootcpu variable. Copy the output into the submit file.</p>
</blockquote>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">(gdb) p *<span class="hljs-keyword">bootcpu</span><br><span class="hljs-keyword"></span>Cannot access memory <span class="hljs-built_in">at</span> <span class="hljs-keyword">address </span><span class="hljs-number">0x80000</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Question 21:</strong> Now, step through that function until after the line that says 'bootcpu = cpu_create(0)'. Now print the content of *bootcpu and paste the output.</p>
</blockquote>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">(gdb) p *bootcpu</span><br><span class="language-xml">$2 = &#123;c_self = 0x8003af00, c_number = 0, c_hardware_number = 0, c_curthread = 0x8003bf80, c_zombies = &#123;tl_head = &#123;</span><br><span class="language-xml">      tln_prev = 0x0, tln_next = 0x8003af1c, tln_self = 0x0&#125;, tl_tail = &#123;tln_prev = 0x8003af10, tln_next = 0x0, </span><br><span class="language-xml">      tln_self = 0x0&#125;, tl_count = 0&#125;, c_hardclocks = 0, c_spinlocks = 0, c_isidle = false, c_runqueue = &#123;tl_head = &#123;</span><br><span class="language-xml">      tln_prev = 0x0, tln_next = 0x8003af44, tln_self = 0x0&#125;, tl_tail = &#123;tln_prev = 0x8003af38, tln_next = 0x0, </span><br><span class="language-xml">      tln_self = 0x0&#125;, tl_count = 0&#125;, c_runqueue_lock = &#123;splk_lock = 0, splk_holder = 0x0&#125;, c_ipi_pending = 0, </span><br><span class="language-xml">  c_shootdown = </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ts_placeholder</span> = <span class="hljs-number">0</span>&#125; &lt;repeats <span class="hljs-number">16</span> times&gt;&#125;, c_numshootdown = <span class="hljs-number">0</span>, c_ipi_lock = &#123;splk_lock = <span class="hljs-number">0</span>, </span><br><span class="hljs-template-variable">    splk_holder = <span class="hljs-number">0</span>x0&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>Copy the contents of <code>kern/gdbscripts/array</code> into your .gdbinit file.</p>
</blockquote>
<blockquote>
<p><strong>Question 22:</strong> Print the <code>allcpus</code> array before the boot() function is executed. Paste the output.</p>
</blockquote>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">(gdb)<span class="hljs-built_in"> array </span>allcpus<br>0 items<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Question 23:</strong> Print again the same array after the boot() function is executed. Paste the output.</p>
</blockquote>
<p>After the <code>boot</code> function is executed:</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">(gdb)<span class="hljs-built_in"> array </span>allcpus<br>4 items<br>$1 = (void *) 0x8003bf00<br>$2 = (void *) 0x8003be00<br>$3 = (void *) 0x8003bd00<br>$4 = (void *) 0x8003bc00<br></code></pre></td></tr></table></figure>
<h2 id="submission"><a class="markdownIt-Anchor" href="#submission"></a> Submission</h2>
<p>If I put the tag on the wrong commit:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git tag -d asst1-submit     # Deletes the previous tag<br>git tag asst1-submit     # Tag your latest commit<br>git push origin :refs/tags/asst1-submit     # Delete the tag in your remote<br>git push --tags     # Push the tags<br></code></pre></td></tr></table></figure>
<p>We have finished Assignment1!😊</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/OS/" class="category-chain-item">OS</a>
  
  
    <span>></span>
    
  <a href="/categories/OS/OS161/" class="category-chain-item">OS161</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/OS/" class="print-no-link">#OS</a>
      
        <a href="/tags/OS161/" class="print-no-link">#OS161</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>OS161 Assignment 1</div>
      <div>http://oooscar8.github.io/2024/09/16/OS161-A1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Alex Sun</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/26/Synchronization/" title="Synchronization">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Synchronization</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/12/Intro/" title="Introduction to Operating Systems">
                        <span class="hidden-mobile">Introduction to Operating Systems</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'http://oooscar8.github.io/2024/09/16/OS161-A1/';
          this.page.identifier = '/2024/09/16/OS161-A1/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'fluid' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
